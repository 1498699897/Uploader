{"version":3,"sources":["uploader.js"],"names":["e","exports","module","define","amd","f","window","global","self","Uploader","t","n","r","s","o","u","a","require","i","Error","call","length",1,"_dereq_","UChunk","file","utils","each","files","_event","trigger","extend","prototype","./event","./utils",2,"_Event","_eventData","on","name","func","this","listened","fuc","push","off","splice","args","slice","arguments","apply",3,"opts","support","ie10plus","supportDirectory","defaults","UFile","version","navigator","msPointerEnabled","File","Blob","FileList","webkitSlice","mozSlice","test","userAgent","webAPIFileRead","fileObj","fileType","startByte","endByte","chunk","function_name","readFinished","chunkSize","forceChunkSize","simultaneousUploads","singleFile","fileParameterName","progressCallbacksInterval","speedSmoothingFactor","query","headers","withCredentials","preprocess","method","testMethod","uploadMethod","prioritizeFirstAndLastChunk","allowDuplicateUploads","target","testChunks","generateUniqueIdentifier","maxChunkRetries","chunkRetryInterval","permanentErrors","successStatuses","onDropStopPropagation","initFileFn","readFileFn","_trigger","toArray","unshift","_triggerAsync","nextTick","onDrop","evt","stopPropagation","preventDefault","dataTransfer","items","webkitGetAsEntry","webkitReadDataTransfer","addFiles","readDirectory","reader","readEntries","entries","queue","entry","isFile","fullPath","fileReadSuccess","readError","isDirectory","createReader","decrement","relativePath","substring","fileError","item","getAsFile","addFile","uploadNextChunk","preventEvents","found","paused","chunks","status","send","outstanding","isComplete","assignBrowse","domNodes","attributes","domNode","input","tagName","type","document","createElement","setAttribute","style","visibility","position","width","height","appendChild","addEventListener","click","value","key","that","assignDrop","preventEvent","unAssignDrop","removeEventListener","./file",4,"fileList","isFolder","./chunk",5,"oproto","Object","aproto","Array","serialize","toString","isFunction","fn","isArray","ary","isPlainObject","obj","getPrototypeOf","noop","bind","context","stop","setTimeout","start","end","undefined","isObject","isString","isUndefined","isDefined","len","options","src","copy","copyIsArray","clone","force"],"mappings":"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","file":"uploader.min.js","sourcesContent":["/*!\n * Uploader - Uploader library implements html5 file upload and provides multiple simultaneous, stable, fault tolerant and resumable uploads\n * @version v0.0.1\n * @author dolymood <dolymood@gmail.com>\n * @link https://github.com/dolymood/Uploader\n * @license MIT\n */\n!function(e){if(\"object\"==typeof exports)module.exports=e();else if(\"function\"==typeof define&&define.amd)define(e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Uploader=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\nvar utils = _dereq_('./utils')\nvar _event = _dereq_('./event')\n\nfunction UChunk (file) {\n\tutils.each(file.files, function () {})\n\t_event.trigger('init')\n}\n\nutils.extend(UChunk.prototype, {\n\n})\n\nmodule.exports = UChunk\n\n},{\"./event\":2,\"./utils\":5}],2:[function(_dereq_,module,exports){\nvar each = _dereq_('./utils').each\n\nvar _Event = {\n\n\t_eventData: null,\n\n\ton: function (name, func) {\n\t\tif (!this._eventData) this._eventData = {}\n\t\tif (!this._eventData[name]) this._eventData[name] = []\n\t\tvar listened = false\n\t\teach(this._eventData[name], function (fuc) {\n\t\t\tif (fuc === func) {\n\t\t\t\tlistened = true\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\t\tif (!listened) {\n\t\t\tthis._eventData[name].push(func)\n\t\t}\n\t},\n\n\toff: function (name, func) {\n\t\tif (!this._eventData) this._eventData = {}\n\t\tif (!this._eventData[name] || !this._eventData[name].length) return\n\t\tif (func) {\n\t\t\teach(this._eventData[name], function (fuc, i) {\n\t\t\t\tif (fuc === func) {\n\t\t\t\t\tthis._eventData[name].splice(i, 1)\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t})\n\t\t} else {\n\t\t\tthis._eventData[name] = []\n\t\t}\n\t},\n\n\ttrigger: function (name) {\n\t\tif (!this._eventData) this._eventData = {}\n\t\tif (!this._eventData[name]) return\n\t\tvar args = this._eventData[name].slice.call(arguments, 1)\n\t\teach(this._eventData[name], function (fuc) {\n\t\t\tfuc.apply(null, args)\n\t\t})\n\t}\n}\n\nmodule.exports = _Event\n\n},{\"./utils\":5}],3:[function(_dereq_,module,exports){\nvar utils = _dereq_('./utils')\nvar _event = _dereq_('./event')\nvar UFile = _dereq_('./file')\n\nvar version = '0.0.1'\n\n// ie10+\nvar ie10plus = window.navigator.msPointerEnabled\nvar support = (\n\ttypeof File !== 'undefined' &&\n\ttypeof Blob !== 'undefined' &&\n\ttypeof FileList !== 'undefined' &&\n\t(\n\t\t!!Blob.prototype.slice ||\n\t\t!!Blob.prototype.webkitSlice ||\n\t\t!!Blob.prototype.mozSlice ||\n\t\tfalse\n\t)\n)\nvar supportDirectory = /WebKit/.test(window.navigator.userAgent)\n\nfunction Uploader (opts) {\n\tthis.support = support\n\tif (!this.support || ie10plus) {\n\t\treturn\n\t}\n\tthis.supportDirectory = supportDirectory\n\n\tthis.opts = utils.extend(Uploader.defaults, opts || {})\n\n\tthis.f = new UFile()\n}\n\n/**\n * Default read function using the webAPI\n *\n * @function webAPIFileRead(fileObj, fileType, startByte, endByte, chunk)\n *\n */\nvar webAPIFileRead = function (fileObj, fileType, startByte, endByte, chunk) {\n\tvar function_name = 'slice'\n\n\tif (fileObj.file.slice) {\n\t\tfunction_name = 'slice'\n\t} else if (fileObj.file.mozSlice) {\n\t\tfunction_name = 'mozSlice'\n\t} else if (fileObj.file.webkitSlice) {\n\t\tfunction_name = 'webkitSlice'\n\t}\n\tchunk.readFinished(fileObj.file[function_name](startByte, endByte, fileType))\n}\n\nUploader.version = version\n\nUploader.defaults = {\n\tchunkSize: 1024 * 1024,\n\tforceChunkSize: false,\n\tsimultaneousUploads: 3,\n\tsingleFile: false,\n\tfileParameterName: 'file',\n\tprogressCallbacksInterval: 500,\n\tspeedSmoothingFactor: 0.1,\n\tquery: {},\n\theaders: {},\n\twithCredentials: false,\n\tpreprocess: null,\n\tmethod: 'multipart',\n\ttestMethod: 'GET',\n\tuploadMethod: 'POST',\n\tprioritizeFirstAndLastChunk: false,\n\tallowDuplicateUploads: false,\n\ttarget: '/',\n\ttestChunks: true,\n\tgenerateUniqueIdentifier: null,\n\tmaxChunkRetries: 0,\n\tchunkRetryInterval: null,\n\tpermanentErrors: [404, 415, 500, 501],\n\tsuccessStatuses: [200, 201, 202],\n\tonDropStopPropagation: false,\n\tinitFileFn: null,\n\treadFileFn: webAPIFileRead\n}\n\nutils.extend(Uploader.prototype, _event)\nutils.extend(Uploader.prototype, {\n\n\t_trigger: function (name) {\n\t\tvar args = utils.toArray(arguments, 1)\n\t\tthis.trigger.apply(this, arguments)\n\t\tif (name !== 'catchAll') {\n\t\t\targs.unshift('catchAll')\n\t\t\tthis.trigger.apply(this, args)\n\t\t}\n\t},\n\n\t_triggerAsync: function () {\n\t\tvar args = arguments\n\t\tutils.nextTick(function () {\n\t\t\tthis._trigger.apply(this, args)\n\t\t}, this)\n\t},\n\n\tonDrop: function (evt) {\n\t\tif (this.opts.onDropStopPropagation) {\n\t\t\tevt.stopPropagation()\n\t\t}\n\t\tevt.preventDefault()\n\t\tvar dataTransfer = evt.dataTransfer\n\t\tif (dataTransfer.items && dataTransfer.items[0] &&\n\t\t\tdataTransfer.items[0].webkitGetAsEntry) {\n\t\t\tthis.webkitReadDataTransfer(evt)\n\t\t} else {\n\t\t\tthis.addFiles(dataTransfer.files, evt)\n\t\t}\n\t},\n\n\twebkitReadDataTransfer: function (evt) {\n\t\tvar self = this\n\t\tvar queue = evt.dataTransfer.items.length\n\t\tvar files = []\n\t\tutils.each(evt.dataTransfer.items, function (item) {\n\t\t\tvar entry = item.webkitGetAsEntry()\n\t\t\tif (!entry) {\n\t\t\t\tdecrement()\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (entry.isFile) {\n\t\t\t\t// due to a bug in Chrome's File System API impl - #149735\n\t\t\t\tfileReadSuccess(item.getAsFile(), entry.fullPath)\n\t\t\t} else {\n\t\t\t\treadDirectory(entry.createReader())\n\t\t\t}\n\t\t})\n\t\tfunction readDirectory (reader) {\n\t\t\treader.readEntries(function (entries) {\n\t\t\t\tif (entries.length) {\n\t\t\t\t\tqueue += entries.length\n\t\t\t\t\tutils.each(entries, function (entry) {\n\t\t\t\t\t\tif (entry.isFile) {\n\t\t\t\t\t\t\tvar fullPath = entry.fullPath\n\t\t\t\t\t\t\tentry.file(function (file) {\n\t\t\t\t\t\t\t\tfileReadSuccess(file, fullPath)\n\t\t\t\t\t\t\t}, readError)\n\t\t\t\t\t\t} else if (entry.isDirectory) {\n\t\t\t\t\t\t\treadDirectory(entry.createReader())\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\treadDirectory(reader)\n\t\t\t\t} else {\n\t\t\t\t\tdecrement()\n\t\t\t\t}\n\t\t\t}, readError)\n\t\t}\n\t\tfunction fileReadSuccess (file, fullPath) {\n\t\t\t// relative path should not start with \"/\"\n\t\t\tfile.relativePath = fullPath.substring(1)\n\t\t\tfiles.push(file)\n\t\t\tdecrement()\n\t\t}\n\t\tfunction readError (fileError) {\n\t\t\tthrow fileError\n\t\t}\n\t\tfunction decrement () {\n\t\t\tif (--queue === 0) {\n\t\t\t\tself.addFiles(files, evt)\n\t\t\t}\n\t\t}\n\t},\n\n\taddFiles: function (files, evt) {\n\n\t},\n\n\taddFile: function (file, evt) {\n\t\tthis.addFiles([file], evt)\n\t},\n\n\tuploadNextChunk: function (preventEvents) {\n\t\tvar found = false\n\t\tif (this.opts.prioritizeFirstAndLastChunk) {\n\t\t\tutils.each(this.files, function (file) {\n\t\t\t\tif (!file.paused && file.chunks.length &&\n\t\t\t\t\tfile.chunks[0].status() === 'pending') {\n\t\t\t\t\tfile.chunks[0].send()\n\t\t\t\t\tfound = true\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\tif (!file.paused && file.chunks.length > 1 &&\n\t\t\t\t\tfile.chunks[file.chunks.length - 1].status() === 'pending') {\n\t\t\t\t\tfile.chunks[file.chunks.length - 1].send()\n\t\t\t\t\tfound = true\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t})\n\t\t\tif (found) {\n\t\t\t\treturn found\n\t\t\t}\n\t\t}\n\n\t\t// Now, simply look for the next, best thing to upload\n\t\tutils.each(this.files, function (file) {\n\t\t\tif (!file.paused) {\n\t\t\t\tutils.each(file.chunks, function (chunk) {\n\t\t\t\t\tif (chunk.status() === 'pending') {\n\t\t\t\t\t\tchunk.send()\n\t\t\t\t\t\tfound = true\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (found) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\t\tif (found) {\n\t\t\treturn true\n\t\t}\n\n\t\t// The are no more outstanding chunks to upload, check is everything is done\n\t\tvar outstanding = false\n\t\tutils.each(this.files, function (file) {\n\t\t\tif (!file.isComplete()) {\n\t\t\t\toutstanding = true\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\t\tif (!outstanding && !preventEvents) {\n\t\t\t// All chunks have been uploaded, complete\n\t\t\tthis._triggerAsync('complete')\n\t\t}\n\t\treturn false\n\t},\n\n\t/**\n\t * Assign a browse action to one or more DOM nodes.\n\t * @function\n\t * @param {Element|Array.<Element>} domNodes\n\t * @param {boolean} isDirectory Pass in true to allow directories to\n\t * @param {boolean} singleFile prevent multi file upload\n\t * @param {Object} attributes set custom attributes:\n\t *  http://www.w3.org/TR/html-markup/input.file.html#input.file-attributes\n\t *  eg: accept: 'image/*'\n\t * be selected (Chrome only).\n\t */\n\tassignBrowse: function (domNodes, isDirectory, singleFile, attributes) {\n\t\tif (typeof domNodes.length === 'undefined') {\n\t\t\tdomNodes = [domNodes]\n\t\t}\n\n\t\tutils.each(domNodes, function (domNode) {\n\t\t\tvar input\n\t\t\tif (domNode.tagName === 'INPUT' && domNode.type === 'file') {\n\t\t\t\tinput = domNode\n\t\t\t} else {\n\t\t\t\tinput = document.createElement('input')\n\t\t\t\tinput.setAttribute('type', 'file')\n\t\t\t\t// display:none - not working in opera 12\n\t\t\t\tutils.extend(input.style, {\n\t\t\t\t\tvisibility: 'hidden',\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\twidth: '1px',\n\t\t\t\t\theight: '1px'\n\t\t\t\t})\n\t\t\t\t// for opera 12 browser, input must be assigned to a document\n\t\t\t\tdomNode.appendChild(input)\n\t\t\t\t// https://developer.mozilla.org/en/using_files_from_web_applications)\n\t\t\t\t// event listener is executed two times\n\t\t\t\t// first one - original mouse click event\n\t\t\t\t// second - input.click(), input is inside domNode\n\t\t\t\tdomNode.addEventListener('click', function () {\n\t\t\t\t\tinput.click()\n\t\t\t\t}, false)\n\t\t\t}\n\t\t\tif (!this.opts.singleFile && !singleFile) {\n\t\t\t\tinput.setAttribute('multiple', 'multiple')\n\t\t\t}\n\t\t\tif (isDirectory) {\n\t\t\t\tinput.setAttribute('webkitdirectory', 'webkitdirectory')\n\t\t\t}\n\t\t\tutils.each(attributes, function (value, key) {\n\t\t\t\tinput.setAttribute(key, value)\n\t\t\t})\n\t\t\t// When new files are added, simply append them to the overall list\n\t\t\tvar that = this\n\t\t\tinput.addEventListener('change', function (e) {\n\t\t\t\tif (e.target.value) {\n\t\t\t\t\tthat.addFiles(e.target.files, e)\n\t\t\t\t\te.target.value = ''\n\t\t\t\t}\n\t\t\t}, false)\n\t\t}, this)\n\t},\n\n\t/**\n\t * Assign one or more DOM nodes as a drop target.\n\t * @function\n\t * @param {Element|Array.<Element>} domNodes\n\t */\n\tassignDrop: function (domNodes) {\n\t\tif (typeof domNodes.length === 'undefined') {\n\t\t\tdomNodes = [domNodes]\n\t\t}\n\t\tutils.each(domNodes, function (domNode) {\n\t\t\tdomNode.addEventListener('dragover', utils.preventEvent, false)\n\t\t\tdomNode.addEventListener('dragenter', utils.preventEvent, false)\n\t\t\tdomNode.addEventListener('drop', this.onDrop, false)\n\t\t}, this)\n\t},\n\n\t/**\n\t * Un-assign drop event from DOM nodes\n\t * @function\n\t * @param domNodes\n\t */\n\tunAssignDrop: function (domNodes) {\n\t\tif (typeof domNodes.length === 'undefined') {\n\t\t\tdomNodes = [domNodes]\n\t\t}\n\t\tutils.each(domNodes, function (domNode) {\n\t\t\tdomNode.removeEventListener('dragover', utils.preventEvent, false)\n\t\t\tdomNode.removeEventListener('dragenter', utils.preventEvent, false)\n\t\t\tdomNode.removeEventListener('drop', this.onDrop, false)\n\t\t}, this)\n\t}\n\n})\n\nmodule.exports = Uploader\n\n},{\"./event\":2,\"./file\":4,\"./utils\":5}],4:[function(_dereq_,module,exports){\nvar utils = _dereq_('./utils')\nvar _event = _dereq_('./event')\nvar UChunk = _dereq_('./chunk')\n\nfunction UFile () {\n\tthis.files = []\n\tthis.fileList = []\n\tthis.chunks = []\n\n\tthis.isFolder = false\n\n\tthis.chunks.push(new UChunk(this))\n\t_event.trigger('init')\n}\n\nutils.extend(UFile.prototype, {\n\n})\n\nmodule.exports = UFile\n\n},{\"./chunk\":1,\"./event\":2,\"./utils\":5}],5:[function(_dereq_,module,exports){\nvar oproto = Object.prototype\nvar aproto = Array.prototype\nvar serialize = oproto.toString\n\nvar isFunction = function (fn) {\n\treturn serialize.call(fn) === '[object Function]'\n}\n\nvar isArray = Array.isArray || function (ary) {\n\treturn serialize.call(ary) === '[object Array]'\n}\n\nvar isPlainObject = function (obj) {\n\treturn serialize.call(obj) === '[object Object]' && Object.getPrototypeOf(obj) === oproto\n}\n\nvar utils = {\n\n\tnoop: function () {},\n\tbind: function (fn, context) {\n\t\treturn function () {\n\t\t\treturn fn.apply(this, arguments)\n\t\t}\n\t},\n\tpreventEvent: function (evt) {\n\t\tevt.preventDefault()\n\t},\n\tstop: function (evt) {\n\t\tevt.preventDefault()\n\t\tevt.stopPropagation()\n\t},\n\tnextTick: function (fn, context) {\n\t\tsetTimeout(utils.bind(fn, context), 0)\n\t},\n\ttoArray: function (ary, start, end) {\n\t\tif (start === undefined) start = 0\n\t\tif (end === undefined) end = ary.length\n\t\treturn aproto.slice.call(ary, start, end)\n\t},\n\n\tisPlainObject: isPlainObject,\n\tisFunction: isFunction,\n\tisArray: isArray,\n\tisObject: function (obj) {\n\t\treturn Object(obj) === obj\n\t},\n\tisString: function (s) {\n\t\treturn typeof s === 'string'\n\t},\n\tisUndefined: function (a) {\n\t\treturn typeof a === 'undefined'\n\t},\n\tisDefined: function (a) {\n\t\treturn typeof a !== 'undefined'\n\t},\n\n\teach: function (ary, func, context) {\n\t\tfor (var i = 0, len = ary.length; i < len; i++) {\n\t\t\tif (func.call(context, ary[i], i, ary) === false) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t},\n\n\textend: function () {\n\t\tvar options\n\t\tvar name\n\t\tvar src\n\t\tvar copy\n\t\tvar copyIsArray\n\t\tvar clone\n\t\tvar target = arguments[0] || {}\n\t\tvar i = 1\n\t\tvar length = arguments.length\n\t\tvar force = false\n\n\t\t// 如果第一个参数为布尔,判定是否深拷贝\n\t\tif (typeof target === 'boolean') {\n\t\t\tforce = target\n\t\t\ttarget = arguments[1] || {}\n\t\t\ti++\n\t\t}\n\n\t\t// 确保接受方为一个复杂的数据类型\n\t\tif (typeof target !== 'object' && !isFunction(target)) {\n\t\t\ttarget = {}\n\t\t}\n\n\t\t// 如果只有一个参数，那么新成员添加于 extend 所在的对象上\n\t\tif (i === length) {\n\t\t\ttarget = this\n\t\t\ti--\n\t\t}\n\n\t\tfor (; i < length; i++) {\n\t\t\t// 只处理非空参数\n\t\t\tif ((options = arguments[i]) != null) {\n\t\t\t\tfor (name in options) {\n\t\t\t\t\tsrc = target[name]\n\t\t\t\t\tcopy = options[name]\n\n\t\t\t\t\t// 防止环引用\n\t\t\t\t\tif (target === copy) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tif (force && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : []\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {}\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttarget[name] = utils.extend(force, clone, copy)\n\t\t\t\t\t} else if (copy !== undefined) {\n\t\t\t\t\t\ttarget[name] = copy\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn target\n\t}\n}\n\nmodule.exports = utils\n\n},{}]},{},[3])\n(3)\n});"],"sourceRoot":"/source/"}